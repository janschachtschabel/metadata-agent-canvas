<div class="canvas-field" [ngClass]="getStatusClass()">
  <!-- Status Icon -->
  <span class="status-icon" [title]="field.status">{{ getStatusIcon() }}</span>
  
  <!-- Label -->
  <label class="field-label">
    {{ field.label }}
    <span *ngIf="field.isRequired" class="required-marker">*</span>
  </label>
  
  <!-- Input Area -->
  <div class="field-input-container">
    <!-- For parent fields with sub-fields: Show preview instead of chips -->
    <div *ngIf="field.isParent && field.subFields && field.subFields.length > 0" class="structured-field-preview">
      <span class="preview-text">{{ getStructuredPreview() }}</span>
    </div>
    
    <!-- Chips for array fields with existing values (but NOT for parent fields) -->
    <div *ngIf="!field.isParent && field.multiple && field.value && field.value.length > 0" class="chip-container">
      <span *ngFor="let item of field.value" class="chip">
        {{ item }}
        <button class="chip-remove" (click)="removeChip(item)" type="button">×</button>
      </span>
    </div>
    
    <!-- Input field (hidden for parent fields) -->
    <div *ngIf="!field.isParent" class="input-wrapper">
      <textarea
        #textareaRef
        class="field-input"
        [(ngModel)]="inputValue"
        (input)="onInput($event)"
        (blur)="onBlur()"
        (keypress)="onKeyPress($event)"
        [placeholder]="field.description"
        [disabled]="field.status === FieldStatus.EXTRACTING"
        rows="1"
      ></textarea>
      
      <!-- Autocomplete dropdown -->
      <div *ngIf="showAutocomplete" class="autocomplete-dropdown">
        <div 
          *ngFor="let option of filteredOptions" 
          class="autocomplete-option"
          (click)="selectOption(option)"
        >
          {{ option }}
        </div>
      </div>
    </div>
  </div>
  
  <!-- Info Button (only for parent fields, not sub-fields) -->
  <button 
    *ngIf="field.description && !field.parentFieldId" 
    class="info-button"
    [title]="getTooltipText()"
    type="button"
  >
    ℹ️
  </button>
  
  <!-- Error Message -->
  <div *ngIf="field.status === FieldStatus.ERROR && field.extractionError" class="error-message">
    {{ field.extractionError }}
  </div>
  
</div>

<!-- Sub-fields (for complex objects with shape) - Tree structure outside main container -->
<div *ngIf="field.isParent && field.subFields && field.subFields.length > 0" class="sub-fields-tree">
  <div *ngFor="let subField of field.subFields; let isLast = last" class="sub-field-tree-row">
    <!-- Left side: Tree branch + Status + Label -->
    <div class="sub-field-left">
      <!-- Tree branch connector -->
      <div class="tree-branch" [class.tree-branch-last]="isLast">
        <span class="tree-line-vertical"></span>
        <span class="tree-line-horizontal"></span>
      </div>
      
      <!-- Status Icon -->
      <span class="status-icon sub-field-status" [title]="subField.status">{{ getStatusIconForField(subField) }}</span>
      
      <!-- Label -->
      <label class="field-label sub-field-label">
        {{ subField.label }}
        <span *ngIf="subField.isRequired" class="required-marker">*</span>
      </label>
    </div>
    
    <!-- Right side: Input field (aligned with parent inputs) -->
    <div class="sub-field-right">
      <div class="field-input-container">
        <!-- Preview for parent fields -->
        <div *ngIf="subField.isParent && subField.subFields && subField.subFields.length > 0" class="structured-field-preview">
          <span class="preview-text">{{ getStructuredPreviewForField(subField) }}</span>
        </div>
        
        <!-- Regular input for non-parent fields -->
        <textarea
          *ngIf="!subField.isParent"
          class="field-input"
          [(ngModel)]="subField.value"
          (blur)="onSubFieldValueChange(subField)"
          [placeholder]="subField.description"
          [disabled]="subField.status === FieldStatus.EXTRACTING"
          rows="1"
        ></textarea>
      </div>
    </div>
  </div>
</div>
